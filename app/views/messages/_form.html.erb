<%= form_for(@message) do |f| %>
  <% if @message.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@message.errors.count, t('application.error')) %> <%= t('activerecord.errors.template.header') %></h2> <!-- "error", " prohibited this record from being saved" -->

      <ul>
      <% @message.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <% disabled = session[:parent_message_id] ? true : false %>
  <% if admin_user? %>
  <div class="field">
    <%= label_tag :recipient_user_id, t('.to') %><br> <!-- "To:" -->
    <%= collection_select(:message, :recipient_user_id, User.all, :id, :name, {prompt: t('.select_user')}, {disabled: disabled}) %> <!-- "Select User" -->
  </div>
  <div class="field">
    <%= f.label :message_type_id, t('.message_type') %><br> <!-- "Message Type" -->
    <%= collection_select(:message, :message_type_id, MessageType.active_only, :id, :name, {prompt: t('.select_type')}, {disabled: disabled}) %> <!-- "Select Type" -->
  </div>
  <% end %>
  <div class="field">
    <%= f.label :subject %><br>
    <%= f.text_field :subject, {disabled: disabled} %>
  </div>

  <div class="field">
    <%= f.label :body %><br>
    <%= f.text_area :body %>
  </div>

  <div class="actions">
    <%= submit_or_return_to_messages_index(f) %>
  </div>
<% end %>
